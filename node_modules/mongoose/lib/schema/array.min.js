/*!
 * Module dependencies.
 */function SchemaArray(e,t,n){if(t){var r={};if("Object"===t.constructor.name)if(t.type){r=t;t=t.type;delete r.type}else t=Mixed;var i=t.name in Types?Types[t.name]:t;this.casterConstructor=i;this.caster=new i(null,r)}SchemaType.call(this,e,n);var s=this,o,u;if(this.defaultValue){o=this.defaultValue;u="function"==typeof o}this.default(function(){var e=u?o():o||[];return new MongooseArray(e,s.path,this)})}function castToNumber(e){return Types.Number.prototype.cast.call(this,e)}var SchemaType=require("../schematype"),CastError=SchemaType.CastError,NumberSchema=require("./number"),Types={Boolean:require("./boolean"),Date:require("./date"),Number:require("./number"),String:require("./string"),ObjectId:require("./objectid"),Buffer:require("./buffer")},MongooseArray=require("../types").Array,Mixed=require("./mixed"),Query=require("../query"),isMongooseObject=require("../utils").isMongooseObject;SchemaArray.prototype.__proto__=SchemaType.prototype;SchemaArray.prototype.checkRequired=function(e){return!!e&&!!e.length};SchemaArray.prototype.applyGetters=function(e,t){return this.caster.options&&this.caster.options.ref?e:SchemaType.prototype.applyGetters.call(this,e,t)};SchemaArray.prototype.cast=function(e,t,n){if(Array.isArray(e)){e instanceof MongooseArray||(e=new MongooseArray(e,this.path,t));if(this.caster)try{for(var r=0,i=e.length;r<i;r++)e[r]=this.caster.cast(e[r],t,n)}catch(s){throw new CastError(s.type,e)}return e}return this.cast([e],t,n)};SchemaArray.prototype.castForQuery=function(e,t){var n,r;if(arguments.length===2){n=this.$conditionalHandlers[e];if(!n)throw new Error("Can't use "+e+" with Array.");r=n.call(this,t)}else{r=e;var i=this.casterConstructor.prototype,s=i.castForQuery||i.cast;Array.isArray(r)?r=r.map(function(e){s&&(e=s.call(i,e));return isMongooseObject(e)?e.toObject():e}):s&&(r=s.call(i,r))}return r&&isMongooseObject(r)?r.toObject():r};SchemaArray.prototype.$conditionalHandlers={$all:function(t){Array.isArray(t)||(t=[t]);t=t.map(function(e){if(e&&"Object"===e.constructor.name){var t={};t[this.path]=e;var n=new Query(t);n.cast(this.casterConstructor);return n._conditions[this.path]}return e},this);return this.castForQuery(t)},$elemMatch:function(e){var t=new Query(e);t.cast(this.casterConstructor);return t._conditions},$size:castToNumber,$ne:SchemaArray.prototype.castForQuery,$in:SchemaArray.prototype.castForQuery,$nin:SchemaArray.prototype.castForQuery,$regex:SchemaArray.prototype.castForQuery,$near:SchemaArray.prototype.castForQuery,$nearSphere:SchemaArray.prototype.castForQuery,$gt:castToNumber,$gte:castToNumber,$lt:castToNumber,$lte:castToNumber,$within:function(e){var t=new Query(e);t.cast(this.casterConstructor);return t._conditions},$maxDistance:castToNumber};module.exports=SchemaArray;