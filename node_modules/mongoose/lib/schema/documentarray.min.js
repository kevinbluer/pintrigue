/*!
 * Module dependencies.
 */function DocumentArray(e,t,n){function r(){Subdocument.apply(this,arguments)}r.prototype.__proto__=Subdocument.prototype;r.prototype._setSchema(t);r.schema=t;for(var i in t.methods)r.prototype[i]=t.methods[i];for(var i in t.statics)r[i]=t.statics[i];r.options=n;this.schema=t;ArrayType.call(this,e,r,n);this.schema=t;var s=this.path,o=this.defaultValue;this.default(function(){var e=o.call(this);Array.isArray(e)||(e=[e]);return new MongooseDocumentArray(e,s,this)})}var SchemaType=require("../schematype"),ArrayType=require("./array"),MongooseDocumentArray=require("../types/documentarray"),Subdocument=require("../types/embedded"),CastError=SchemaType.CastError,Document=require("../document");DocumentArray.prototype.__proto__=ArrayType.prototype;DocumentArray.prototype.doValidate=function(e,t,n){var r=this;SchemaType.prototype.doValidate.call(this,e,function(n){if(n)return t(n);var i=e&&e.length,s=!1;if(!i)return t();e.forEach(function(e,n){e.validate(function(e){if(e&&!s){e.key=r.key+"."+n+"."+e.key;t(e);s=!0}else--i||t()})})},n)};DocumentArray.prototype.cast=function(e,t,n,r){var i,s;if(Array.isArray(e)){e instanceof MongooseDocumentArray||(e=new MongooseDocumentArray(e,this.path,t));s=e.length;while(s--)if(!(e[s]instanceof Subdocument))if(n){i=new this.casterConstructor(null,e,!0);e[s]=i.init(e[s])}else{r&&(i=r.id(e[s]._id))?i.set(e[s]):i=new this.casterConstructor(e[s],e);e[s]=i}return e}return this.cast([e],t,n,r)};module.exports=DocumentArray;