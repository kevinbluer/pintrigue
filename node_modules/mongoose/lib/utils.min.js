/*!
 * Module dependencies.
 */function pluralize(e){var t,n;if(!~uncountables.indexOf(e.toLowerCase())){n=rules.filter(function(t){return e.match(t[0])});if(n[0])return e.replace(n[0][0],n[0][1])}return e}function cloneObject(e,t){var n=t&&t.retainKeyOrder,r=t&&t.minimize,i={},s,o,u,a,f;if(n)for(a in e){u=clone(e[a],t);if(!r||"undefined"!=typeof u){s||(s=!0);i[a]=u}}else{o=Object.keys(e);f=o.length;while(f--){a=o[f];u=clone(e[a],t);if(!r||"undefined"!=typeof u){s||(s=!0);i[a]=u}}}return r?s&&i:i}function cloneArray(e,t){var n=[];for(var r=0,i=e.length;r<i;r++)n.push(clone(e[r],t));return n}var EventEmitter=require("events").EventEmitter,ObjectId=require("./types/objectid"),ms=require("ms"),MongooseBuffer,MongooseArray,Document;exports.toCollectionName=function(e){return"system.profile"===e?e:"system.indexes"===e?e:pluralize(e.toLowerCase())};exports.pluralization=[[/(m)an$/gi,"$1en"],[/(pe)rson$/gi,"$1ople"],[/(child)$/gi,"$1ren"],[/^(ox)$/gi,"$1en"],[/(ax|test)is$/gi,"$1es"],[/(octop|vir)us$/gi,"$1i"],[/(alias|status)$/gi,"$1es"],[/(bu)s$/gi,"$1ses"],[/(buffal|tomat|potat)o$/gi,"$1oes"],[/([ti])um$/gi,"$1a"],[/sis$/gi,"ses"],[/(?:([^f])fe|([lr])f)$/gi,"$1$2ves"],[/(hive)$/gi,"$1s"],[/([^aeiouy]|qu)y$/gi,"$1ies"],[/(x|ch|ss|sh)$/gi,"$1es"],[/(matr|vert|ind)ix|ex$/gi,"$1ices"],[/([m|l])ouse$/gi,"$1ice"],[/(quiz)$/gi,"$1zes"],[/s$/gi,"s"],[/$/gi,"s"]];var rules=exports.pluralization;exports.uncountables=["advice","energy","excretion","digestion","cooperation","health","justice","labour","machinery","equipment","information","pollution","sewage","paper","money","species","series","rain","rice","fish","sheep","moose","deer","news"];var uncountables=exports.uncountables,Events=EventEmitter;if(!("once"in EventEmitter.prototype)){Events=function(){EventEmitter.apply(this,arguments)};Events.prototype.__proto__=EventEmitter.prototype;Events.prototype.once=function(e,t){var n=this;n.on(e,function r(){n.removeListener(e,r);t.apply(this,arguments)})}}exports.EventEmitter=Events;exports.deepEqual=function e(t,n){if(t===n)return!0;if(t instanceof Date&&n instanceof Date)return t.getTime()===n.getTime();if(t instanceof ObjectId&&n instanceof ObjectId)return t.toString()===n.toString();if(typeof t!="object"&&typeof n!="object")return t==n;if(t===null||n===null||t===undefined||n===undefined)return!1;if(t.prototype!==n.prototype)return!1;if(t instanceof Number&&n instanceof Number)return t.valueOf()===n.valueOf();if(Buffer.isBuffer(t)){if(!Buffer.isBuffer(n))return!1;if(t.length!==n.length)return!1;for(var r=0,i=t.length;r<i;++r)if(t[r]!==n[r])return!1;return!0}isMongooseObject(t)&&(t=t.toObject());isMongooseObject(n)&&(n=n.toObject());try{var s=Object.keys(t),o=Object.keys(n),u,r}catch(a){return!1}if(s.length!=o.length)return!1;s.sort();o.sort();for(r=s.length-1;r>=0;r--)if(s[r]!=o[r])return!1;for(r=s.length-1;r>=0;r--){u=s[r];if(!e(t[u],n[u]))return!1}return!0};exports.clone=function(t,n){if(t===undefined||t===null)return t;if(Array.isArray(t))return cloneArray(t,n);if(isMongooseObject(t))return n&&n.json&&"function"==typeof t.toJSON?t.toJSON(n):t.toObject(n);if("Object"===t.constructor.name)return cloneObject(t,n);if("Date"===t.constructor.name||"Function"===t.constructor.name)return new t.constructor(+t);if("RegExp"===t.constructor.name)return new RegExp(t.source);if(t instanceof ObjectId)return new ObjectId(t.id);if(t.valueOf)return t.valueOf()};var clone=exports.clone;exports.options=function(e,t){var n=Object.keys(e),r=n.length,i;t=t||{};while(r--){i=n[r];i in t||(t[i]=e[i])}return t};exports.random=function(){return Math.random().toString().substr(3)};exports.inGroupsOf=function(t,n,r){var i=[];for(var s=0,o=n.length;s<o;s++){if(s&&s%t===0){r.apply(this,i);i.length=0}i.push(n[s])}r.apply(this,i)};exports.merge=function t(e,n){var r=Object.keys(n),i=r.length,s;while(i--){s=r[i];"undefined"==typeof e[s]?e[s]=n[s]:t(e[s],n[s])}};exports.args=function(e,t,n){var r=[],i=t||0,s=3===arguments.length?n:e.length;for(var o=i;o<s;++o)r[o-i]=e[o];return r};exports.tick=function(t){if("function"!=typeof t)return;return function(){try{t.apply(this,arguments)}catch(e){process.nextTick(function(){throw e})}}};exports.isMongooseObject=function(e){Document||(Document=require("./document"));MongooseArray||(MongooseArray=require("./types").Array);MongooseBuffer||(MongooseBuffer=require("./types").Buffer);return e instanceof Document||e instanceof MongooseArray||e instanceof MongooseBuffer};var isMongooseObject=exports.isMongooseObject;exports.expires=function(t){if(!t||"Object"!=t.constructor.name)return;if(!("expires"in t))return;var n;"string"!=typeof t.expires?n=t.expires:n=Math.round(ms(t.expires)/1e3);t.expiresAfterSeconds=n;delete t.expires};