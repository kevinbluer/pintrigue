/*!
 * Module dependencies.
 */function Mongoose(){this.connections=[];this.plugins=[];this.models={};this.modelSchemas={};this.options={};this.createConnection()}var Schema=require("./schema"),SchemaType=require("./schematype"),VirtualType=require("./virtualtype"),SchemaTypes=Schema.Types,SchemaDefaults=require("./schemadefault"),Types=require("./types"),Query=require("./query"),Promise=require("./promise"),Model=require("./model"),Document=require("./document"),utils=require("./utils"),format=utils.toCollectionName,mongodb=require("mongodb");Mongoose.prototype.set=function(e,t){if(arguments.length==1)return this.options[e];this.options[e]=t;return this};Mongoose.prototype.get=Mongoose.prototype.set;var rgxReplSet=/^.+,.+$/;Mongoose.prototype.createConnection=function(){var e=new Connection(this);this.connections.push(e);arguments.length&&(rgxReplSet.test(arguments[0])?e.openSet.apply(e,arguments):e.open.apply(e,arguments));return e};Mongoose.prototype.connect=function(){var e=this.connection;rgxReplSet.test(arguments[0])?e.openSet.apply(e,arguments):e.open.apply(e,arguments);return this};Mongoose.prototype.disconnect=function(e){var t=this.connections.length,n;this.connections.forEach(function(r){r.close(function(r){if(n)return;if(r){n=r;if(e)return e(r);throw r}e&&(--t||e())})});return this};Mongoose.prototype.model=function(e,t,n,r){if(!(t instanceof Schema)){n=t;t=!1}if("boolean"==typeof n){r=n;n=null}if(!this.modelSchemas[e]){!t&&e in SchemaDefaults&&(t=SchemaDefaults[e]);if(!t)throw new Error("Schema hasn't been registered for model \""+e+'".\n'+"Use mongoose.model(name, schema)");this.modelSchemas[e]=t;for(var i=0,s=this.plugins.length;i<s;i++)t.plugin(this.plugins[i][0],this.plugins[i][1])}if(!this.models[e]){t||(t=this.modelSchemas[e]);n||(n=t.set("collection")||format(e));var o=Model.compile(e,this.modelSchemas[e],n,this.connection,this);r||o.init();this.models[e]=o}return this.models[e]};Mongoose.prototype.plugin=function(e,t){this.plugins.push([e,t]);return this};Mongoose.prototype.__defineGetter__("connection",function(){return this.connections[0]});var driver=global.MONGOOSE_DRIVER_PATH||"./drivers/node-mongodb-native",Connection=require(driver+"/connection"),Collection=require(driver+"/collection");module.exports=exports=new Mongoose;var mongoose=module.exports;mongoose.Collection=Collection;mongoose.Connection=Connection;mongoose.version=JSON.parse(require("fs").readFileSync(__dirname+"/../package.json","utf8")).version;mongoose.Mongoose=Mongoose;mongoose.Schema=Schema;mongoose.SchemaType=SchemaType;mongoose.SchemaTypes=Schema.Types;mongoose.VirtualType=VirtualType;mongoose.Types=Types;mongoose.Query=Query;mongoose.Promise=Promise;mongoose.Model=Model;mongoose.Document=Document;mongoose.Error=require("./error");mongoose.mongo=require("mongodb");