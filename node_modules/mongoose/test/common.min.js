/**
 * Module dependencies.
 */var mongoose=require("../"),Mongoose=mongoose.Mongoose,Collection=mongoose.Collection,assert=require("assert"),startTime=Date.now(),queryCount=0,opened=0,closed=0;["ensureIndex","findAndModify","findOne","find","insert","save","update","remove","count","distinct","isCapped","options"].forEach(function(e){var t=Collection.prototype[e];Collection.prototype[e]=function(){queryCount++;return t.apply(this,arguments)}});var oldOnOpen=Collection.prototype.onOpen;Collection.prototype.onOpen=function(){opened++;return oldOnOpen.apply(this,arguments)};var oldOnClose=Collection.prototype.onClose;Collection.prototype.onClose=function(){closed++;return oldOnClose.apply(this,arguments)};module.exports=function(e){e||(e={});var t;if(e.uri){t=e.uri;delete e.uri}else t=process.env.MONGOOSE_TEST_URI||"mongodb://localhost/mongoose_test";var n=!!e.noErrorListener;delete e.noErrorListener;var r=mongoose.createConnection(t,e);if(n)return r;r.on("error",function(e){assert.ok(e)});return r};module.exports.mongoose=mongoose;