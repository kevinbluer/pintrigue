/**
 * Module dependencies.
 */var assert=require("assert"),http=require("http"),server=http.createServer(function(e,t){if(e.method==="GET")if(e.url==="/delay")setTimeout(function(){t.writeHead(200,{});t.end("delayed")},200);else{var n=JSON.stringify({name:"tj"});t.writeHead(200,{"Content-Type":"application/json; charset=utf8","Content-Length":n.length});t.end(n)}else{var n="";e.setEncoding("utf8");e.addListener("data",function(e){n+=e});e.addListener("end",function(){t.writeHead(200,{});t.end(e.url+" "+n)})}}),delayedServer=http.createServer(function(e,t){t.writeHead(200);t.end("it worked")}),oldListen=delayedServer.listen;delayedServer.listen=function(){var e=arguments;setTimeout(function(){oldListen.apply(delayedServer,e)},100)};module.exports={"test assert.response()":function(e){var t=0;assert.response(server,{url:"/",method:"GET"},{body:'{"name":"tj"}',status:200,headers:{"Content-Type":"application/json; charset=utf8"}});assert.response(server,{url:"/foo",method:"POST",data:"bar baz"},{body:"/foo bar baz",status:200},function(e){++t;assert.ok(e)});assert.response(server,{url:"/foo"},function(e){++t;assert.ok(e.body.indexOf("tj")>=0,"Test assert.response() callback")});assert.response(server,{url:"/delay",timeout:300},{body:"delayed"});e(function(){assert.equal(2,t)})},"test assert.response() regexp":function(){assert.response(server,{url:"/foo",method:"POST",data:"foobar"},{body:/^\/foo foo(bar)?/})},"test assert.response() regexp headers":function(){assert.response(server,{url:"/"},{body:'{"name":"tj"}',headers:{"Content-Type":/^application\/json/}})},"test assert.response() with deferred listen()":function(){assert.response(delayedServer,{url:"/"},{body:"it worked"})}};