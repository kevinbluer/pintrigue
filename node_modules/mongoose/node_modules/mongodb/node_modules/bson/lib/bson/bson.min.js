function BSON(){}function calculateElement(e,t,n){var r=typeof Buffer!="undefined";switch(typeof t){case"string":return 1+(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1+4+(r?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1;case"number":return Math.floor(t)===t&&t>=BSON.JS_INT_MIN&&t<=BSON.JS_INT_MAX?t>=BSON.BSON_INT32_MIN&&t<=BSON.BSON_INT32_MAX?(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+5:(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9:(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9;case"undefined":return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1;case"boolean":return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+2;case"object":if(t==null||t instanceof MinKey||t instanceof MaxKey||t["_bsontype"]=="MinKey"||t["_bsontype"]=="MaxKey")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1;if(t instanceof ObjectID||t["_bsontype"]=="ObjectID")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+13;if(t instanceof Date||isDate(t))return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9;if(typeof Buffer!="undefined"&&Buffer.isBuffer(t))return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+6+t.length;if(t instanceof Long||t instanceof Double||t instanceof Timestamp||t["_bsontype"]=="Long"||t["_bsontype"]=="Double"||t["_bsontype"]=="Timestamp")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9;if(t instanceof Code||t["_bsontype"]=="Code")return t.scope!=null&&Object.keys(t.scope).length>0?(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+4+(r?Buffer.byteLength(t.code.toString(),"utf8"):numberOfBytes(t.code.toString()))+1+BSON.calculateObjectSize(t.scope,n):(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+(r?Buffer.byteLength(t.code.toString(),"utf8"):numberOfBytes(t.code.toString()))+1;if(t instanceof Binary||t["_bsontype"]=="Binary")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+(t.position+1+4+1);if(t instanceof Symbol||t["_bsontype"]=="Symbol")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+((r?Buffer.byteLength(t.value,"utf8"):numberOfBytes(t.value))+4+1+1);if(t instanceof DBRef||t["_bsontype"]=="DBRef"){var i={$ref:t.namespace,$id:t.oid};null!=t.db&&(i.$db=t.db);return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+BSON.calculateObjectSize(i,n)}return t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"?(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+(r?Buffer.byteLength(t.source,"utf8"):numberOfBytes(t.source))+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+BSON.calculateObjectSize(t,n)+1;case"function":if(t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"||String.call(t)=="[object RegExp]")return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+(r?Buffer.byteLength(t.source,"utf8"):numberOfBytes(t.source))+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(n&&t.scope!=null&&Object.keys(t.scope).length>0)return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+4+(r?Buffer.byteLength(t.toString(),"utf8"):numberOfBytes(t.toString()))+1+BSON.calculateObjectSize(t.scope,n);if(n)return(e!=null?(r?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+(r?Buffer.byteLength(t.toString(),"utf8"):numberOfBytes(t.toString()))+1}return 0}if(typeof window=="undefined")var Long=require("./long").Long,Double=require("./double").Double,Timestamp=require("./timestamp").Timestamp,ObjectID=require("./objectid").ObjectID,Symbol=require("./symbol").Symbol,Code=require("./code").Code,MinKey=require("./min_key").MinKey,MaxKey=require("./max_key").MaxKey,DBRef=require("./db_ref").DBRef,Binary=require("./binary").Binary,BinaryParser=require("./binary_parser").BinaryParser,writeIEEE754=require("./float_parser").writeIEEE754,readIEEE754=require("./float_parser").readIEEE754;var isDate=function(t){return typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"};BSON.BSON_INT32_MAX=2147483647;BSON.BSON_INT32_MIN=-2147483648;BSON.BSON_INT64_MAX=Math.pow(2,63)-1;BSON.BSON_INT64_MIN=-Math.pow(2,63);BSON.JS_INT_MAX=9007199254740992;BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);BSON.BSON_DATA_NUMBER=1;BSON.BSON_DATA_STRING=2;BSON.BSON_DATA_OBJECT=3;BSON.BSON_DATA_ARRAY=4;BSON.BSON_DATA_BINARY=5;BSON.BSON_DATA_OID=7;BSON.BSON_DATA_BOOLEAN=8;BSON.BSON_DATA_DATE=9;BSON.BSON_DATA_NULL=10;BSON.BSON_DATA_REGEXP=11;BSON.BSON_DATA_CODE=13;BSON.BSON_DATA_SYMBOL=14;BSON.BSON_DATA_CODE_W_SCOPE=15;BSON.BSON_DATA_INT=16;BSON.BSON_DATA_TIMESTAMP=17;BSON.BSON_DATA_LONG=18;BSON.BSON_DATA_MIN_KEY=255;BSON.BSON_DATA_MAX_KEY=127;BSON.BSON_BINARY_SUBTYPE_DEFAULT=0;BSON.BSON_BINARY_SUBTYPE_FUNCTION=1;BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;BSON.BSON_BINARY_SUBTYPE_UUID=3;BSON.BSON_BINARY_SUBTYPE_MD5=4;BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128;BSON.calculateObjectSize=function(t,n){var r=5;if(Array.isArray(t))for(var i=0;i<t.length;i++)r+=calculateElement(i.toString(),t[i],n);else{t.toBSON&&(t=t.toBSON());for(var s in t)r+=calculateElement(s,t[s],n)}return r};BSON.serializeWithBufferAndIndex=function(t,n,r,i,s){s=s==null?!1:s;var o=r.length;r[i++]=o&255;r[i++]=o>>8&255;r[i++]=o>>16&255;r[i++]=o>>24&255;return serializeObject(t,n,r,i,s)-1};var serializeObject=function(e,t,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)r=packElement(s.toString(),e[s],t,n,r,i);else{e.toBSON&&(e=e.toBSON());for(var o in e){t==1&&o!="$db"&&o!="$ref"&&o!="$id"&&BSON.checkKey(o);r=packElement(o,e[o],t,n,r,i)}}n[r++]=0;return r},stringToBytes=function(e){var t,n,r=[];for(var i=0;i<e.length;i++){t=e.charCodeAt(i);n=[];do{n.push(t&255);t>>=8}while(t);r=r.concat(n.reverse())}return r},numberOfBytes=function(e){var t,n,r=0;for(var i=0;i<e.length;i++){t=e.charCodeAt(i);n=[];do{n.push(t&255);t>>=8}while(t);r+=n.length}return r},writeToTypedArray=function(e,t,n){var r=stringToBytes(t);for(var i=0;i<r.length;i++)e[n+i]=r[i];return r.length},supportsBuffer=typeof Buffer!="undefined",packElement=function(e,t,n,r,i,s){var o=i;switch(typeof t){case"string":r[i++]=BSON.BSON_DATA_STRING;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var a=supportsBuffer?Buffer.byteLength(t)+1:numberOfBytes(t)+1;r[i+3]=a>>24&255;r[i+2]=a>>16&255;r[i+1]=a>>8&255;r[i]=a&255;i+=4;supportsBuffer?r.write(t,i,"utf8"):writeToTypedArray(r,t,i);i=i+a-1;r[i++]=0;return i;case"number":if(Math.floor(t)===t&&t>=BSON.JS_INT_MIN&&t<=BSON.JS_INT_MAX)if(t>=BSON.BSON_INT32_MIN&&t<=BSON.BSON_INT32_MAX){r[i++]=BSON.BSON_DATA_INT;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;r[i++]=t&255;r[i++]=t>>8&255;r[i++]=t>>16&255;r[i++]=t>>24&255}else if(t>=BSON.JS_INT_MIN&&t<=BSON.JS_INT_MAX){r[i++]=BSON.BSON_DATA_NUMBER;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;writeIEEE754(r,t,i,"little",52,8);i+=8}else{r[i++]=BSON.BSON_DATA_LONG;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var f=Long.fromNumber(t),l=f.getLowBits(),c=f.getHighBits();r[i++]=l&255;r[i++]=l>>8&255;r[i++]=l>>16&255;r[i++]=l>>24&255;r[i++]=c&255;r[i++]=c>>8&255;r[i++]=c>>16&255;r[i++]=c>>24&255}else{r[i++]=BSON.BSON_DATA_NUMBER;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;writeIEEE754(r,t,i,"little",52,8);i+=8}return i;case"undefined":r[i++]=BSON.BSON_DATA_NULL;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;return i;case"boolean":r[i++]=BSON.BSON_DATA_BOOLEAN;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;r[i++]=t?1:0;return i;case"object":if(t===null||t instanceof MinKey||t instanceof MaxKey||t["_bsontype"]=="MinKey"||t["_bsontype"]=="MaxKey"){t===null?r[i++]=BSON.BSON_DATA_NULL:t instanceof MinKey?r[i++]=BSON.BSON_DATA_MIN_KEY:r[i++]=BSON.BSON_DATA_MAX_KEY;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;return i}if(t instanceof ObjectID||t["_bsontype"]=="ObjectID"){r[i++]=BSON.BSON_DATA_OID;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;supportsBuffer?r.write(t.id,i,"binary"):writeToTypedArray(r,t.id,i);i+=12;return i}if(t instanceof Date||isDate(t)){r[i++]=BSON.BSON_DATA_DATE;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var h=Long.fromNumber(t.getTime()),l=h.getLowBits(),c=h.getHighBits();r[i++]=l&255;r[i++]=l>>8&255;r[i++]=l>>16&255;r[i++]=l>>24&255;r[i++]=c&255;r[i++]=c>>8&255;r[i++]=c>>16&255;r[i++]=c>>24&255;return i}if(typeof Buffer!="undefined"&&Buffer.isBuffer(t)){r[i++]=BSON.BSON_DATA_BINARY;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var a=t.length;r[i++]=a&255;r[i++]=a>>8&255;r[i++]=a>>16&255;r[i++]=a>>24&255;r[i++]=BSON.BSON_BINARY_SUBTYPE_DEFAULT;t.copy(r,i,0,a);i+=a;return i}if(t instanceof Long||t instanceof Timestamp||t["_bsontype"]=="Long"||t["_bsontype"]=="Timestamp"){r[i++]=t instanceof Long?BSON.BSON_DATA_LONG:BSON.BSON_DATA_TIMESTAMP;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var l=t.getLowBits(),c=t.getHighBits();r[i++]=l&255;r[i++]=l>>8&255;r[i++]=l>>16&255;r[i++]=l>>24&255;r[i++]=c&255;r[i++]=c>>8&255;r[i++]=c>>16&255;r[i++]=c>>24&255;return i}if(t instanceof Double||t["_bsontype"]=="Double"){r[i++]=BSON.BSON_DATA_NUMBER;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;writeIEEE754(r,t,i,"little",52,8);i+=8;return i}if(t instanceof Code||t["_bsontype"]=="Code"){if(t.scope!=null&&Object.keys(t.scope).length>0){r[i++]=BSON.BSON_DATA_CODE_W_SCOPE;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var p=BSON.calculateObjectSize(t.scope,s),d=t.code.toString(),v=supportsBuffer?Buffer.byteLength(d)+1:numberOfBytes(d)+1,m=4+v+p+4;r[i++]=m&255;r[i++]=m>>8&255;r[i++]=m>>16&255;r[i++]=m>>24&255;r[i++]=v&255;r[i++]=v>>8&255;r[i++]=v>>16&255;r[i++]=v>>24&255;supportsBuffer?r.write(d,i,"utf8"):writeToTypedArray(r,d,i);i=i+v-1;r[i++]=0;var g=supportsBuffer?new Buffer(p):new Uint8Array(new ArrayBuffer(p));serializeObject(t.scope,n,g,0,s);var y=p;r[i++]=y&255;r[i++]=y>>8&255;r[i++]=y>>16&255;r[i++]=y>>24&255;supportsBuffer?g.copy(r,i,0,p):r.set(g,i);i=i+y-5;r[i++]=0;return i}r[i++]=BSON.BSON_DATA_CODE;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var d=t.code.toString(),a=supportsBuffer?Buffer.byteLength(d)+1:numberOfBytes(d)+1;r[i++]=a&255;r[i++]=a>>8&255;r[i++]=a>>16&255;r[i++]=a>>24&255;r.write(d,i,"utf8");i=i+a-1;r[i++]=0;return i}if(t instanceof Binary||t["_bsontype"]=="Binary"){r[i++]=BSON.BSON_DATA_BINARY;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var b=t.value(!0),a=t.position;r[i++]=a&255;r[i++]=a>>8&255;r[i++]=a>>16&255;r[i++]=a>>24&255;r[i++]=t.sub_type;supportsBuffer?b.copy(r,i,0,t.position):r.set(b,i);i+=t.position;return i}if(t instanceof Symbol||t["_bsontype"]=="Symbol"){r[i++]=BSON.BSON_DATA_SYMBOL;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var a=supportsBuffer?Buffer.byteLength(t.value)+1:numberOfBytes(t.value)+1;r[i++]=a&255;r[i++]=a>>8&255;r[i++]=a>>16&255;r[i++]=a>>24&255;r.write(t.value,i,"utf8");i=i+a-1;r[i++]=0;return i}if(t instanceof DBRef||t["_bsontype"]=="DBRef"){r[i++]=BSON.BSON_DATA_OBJECT;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var w={$ref:t.namespace,$id:t.oid};null!=t.db&&(w.$db=t.db);var a=BSON.calculateObjectSize(w,s),E=BSON.serializeWithBufferAndIndex(w,n,r,i,s);r[i++]=a&255;r[i++]=a>>8&255;r[i++]=a>>16&255;r[i++]=a>>24&255;r[E++]=0;return E}if(t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"){r[i++]=BSON.BSON_DATA_REGEXP;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;supportsBuffer?r.write(t.source,i,"utf8"):writeToTypedArray(r,t.source,i);i+=supportsBuffer?Buffer.byteLength(t.source):numberOfBytes(t.source);r[i++]=0;t.global&&(r[i++]=115);t.ignoreCase&&(r[i++]=105);t.multiline&&(r[i++]=109);r[i++]=0;return i}r[i++]=Array.isArray(t)?BSON.BSON_DATA_ARRAY:BSON.BSON_DATA_OBJECT;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var E=serializeObject(t,n,r,i+4,s),a=E-i;r[i++]=a&255;r[i++]=a>>8&255;r[i++]=a>>16&255;r[i++]=a>>24&255;return E;case"function":if(t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"||String.call(t)=="[object RegExp]"){r[i++]=BSON.BSON_DATA_REGEXP;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;r.write(t.source,i,"utf8");i+=supportsBuffer?Buffer.byteLength(t.source):numberOfBytes(t.source);r[i++]=0;t.global&&(r[i++]=115);t.ignoreCase&&(r[i++]=105);t.multiline&&(r[i++]=109);r[i++]=0;return i}if(s&&t.scope!=null&&Object.keys(t.scope).length>0){r[i++]=BSON.BSON_DATA_CODE_W_SCOPE;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var p=BSON.calculateObjectSize(t.scope,s),d=t.toString(),v=supportsBuffer?Buffer.byteLength(d)+1:numberOfBytes(d)+1,m=4+v+p;r[i++]=m&255;r[i++]=m>>8&255;r[i++]=m>>16&255;r[i++]=m>>24&255;r[i++]=v&255;r[i++]=v>>8&255;r[i++]=v>>16&255;r[i++]=v>>24&255;r.write(d,i,"utf8");i=i+v-1;r[i++]=0;var g=new Buffer(p);serializeObject(t.scope,n,g,0,s);var y=p-4;r[i++]=y&255;r[i++]=y>>8&255;r[i++]=y>>16&255;r[i++]=y>>24&255;g.copy(r,i,0,p);i=i+y-5;r[i++]=0;return i}if(s){r[i++]=BSON.BSON_DATA_CODE;var u=supportsBuffer?r.write(e,i,"utf8"):writeToTypedArray(r,e,i);i=i+u+1;r[i-1]=0;var d=t.toString(),a=supportsBuffer?Buffer.byteLength(d)+1:numberOfBytes(d)+1;r[i++]=a&255;r[i++]=a>>8&255;r[i++]=a>>16&255;r[i++]=a>>24&255;r.write(d,i,"utf8");i=i+a-1;r[i++]=0;return i}}return i};BSON.serialize=function(e,t,n,r){var i=null,s=BSON.calculateObjectSize(e,r);if(i=typeof Buffer!="undefined"){i=new Buffer(s);n=!0}else typeof Uint8Array!="undefined"?i=new Uint8Array(new ArrayBuffer(s)):i=new Array(s);BSON.serializeWithBufferAndIndex(e,t,i,0,r);return i};var functionCache=BSON.functionCache={},table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],crc32=function(e,t,n){var r=0,i=0,s=0;r^=-1;for(var o=t,u=n;o<u;o++){s=(r^e[o])&255;i=table[s];r=r>>>8^i}return r^-1};BSON.deserializeStream=function(e,t,n,r,i,s){s=s!=null?s:{};var o=t;for(var u=0;u<n;u++){var a=e[o]|e[o+1]<<8|e[o+2]<<16|e[o+3]<<24;s.index=o;r[i+u]=BSON.deserialize(e,s);o+=a}return o};var isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;if(functionCache[hash]==null){eval("value = "+functionString);functionCache[hash]=value}return functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;eval("value = "+functionString);return value},convertUint8ArrayToUtf8String=function(e,t,n){return BinaryParser.decode_utf8(convertArraytoUtf8BinaryString(e,t,n))},convertArraytoUtf8BinaryString=function(e,t,n){var r="";for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r};BSON.deserialize=function(e,t,n){t=t==null?{}:t;var r=t["evalFunctions"]==null?!1:t.evalFunctions,i=t["cacheFunctions"]==null?!1:t.cacheFunctions,s=t["cacheFunctionsCrc32"]==null?!1:t.cacheFunctionsCrc32;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var o=typeof t["index"]=="number"?t.index:0,u=function(){var t=o;while(e[t]!==0)t++;var n=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",o,t):convertUint8ArrayToUtf8String(e,o,t);o=t+1;return n},a=n?[]:{},f=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24;if(f<5||f>e.length)throw new Error("corrupt bson message");for(;;){var l=e[o++];if(l==0)break;var c=u();switch(l){case BSON.BSON_DATA_OID:var h=supportsBuffer&&Buffer.isBuffer(e)?e.toString("binary",o,o+12):convertArraytoUtf8BinaryString(e,o,o+12);a[c]=new ObjectID(h);o+=12;break;case BSON.BSON_DATA_STRING:var p=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24;a[c]=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",o,o+p-1):convertUint8ArrayToUtf8String(e,o,o+p-1);o+=p;break;case BSON.BSON_DATA_INT:a[c]=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24;break;case BSON.BSON_DATA_NUMBER:a[c]=readIEEE754(e,o,"little",52,8);o+=8;break;case BSON.BSON_DATA_DATE:var d=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24,v=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24;a[c]=new Date((new Long(d,v)).toNumber());break;case BSON.BSON_DATA_BOOLEAN:a[c]=e[o++]==1;break;case BSON.BSON_DATA_NULL:a[c]=null;break;case BSON.BSON_DATA_BINARY:var m=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24,g=e[o++];if(e["slice"]!=null)a[c]=new Binary(e.slice(o,o+m),g);else{var y=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(m)):new Array(m);for(var b=0;b<m;b++)y[b]=e[o+b];a[c]=new Binary(y,g)}o+=m;break;case BSON.BSON_DATA_ARRAY:t.index=o;var w=e[o]|e[o+1]<<8|e[o+2]<<16|e[o+3]<<24;a[c]=BSON.deserialize(e,t,!0);o+=w;break;case BSON.BSON_DATA_OBJECT:t.index=o;var w=e[o]|e[o+1]<<8|e[o+2]<<16|e[o+3]<<24;a[c]=BSON.deserialize(e,t,!1);o+=w;break;case BSON.BSON_DATA_REGEXP:var E=u(),S=u(),x=new Array(S.length);for(var b=0;b<S.length;b++)switch(S[b]){case"m":x[b]="m";break;case"s":x[b]="g";break;case"i":x[b]="i"}a[c]=new RegExp(E,x.join(""));break;case BSON.BSON_DATA_LONG:var d=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24,v=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24,T=new Long(d,v);a[c]=T.lessThanOrEqual(JS_INT_MAX_LONG)&&T.greaterThanOrEqual(JS_INT_MIN_LONG)?T.toNumber():T;break;case BSON.BSON_DATA_SYMBOL:var p=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24;a[c]=new Symbol(e.toString("utf8",o,o+p-1));o+=p;break;case BSON.BSON_DATA_TIMESTAMP:var d=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24,v=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24;a[c]=new Timestamp(d,v);break;case BSON.BSON_DATA_MIN_KEY:a[c]=new MinKey;break;case BSON.BSON_DATA_MAX_KEY:a[c]=new MaxKey;break;case BSON.BSON_DATA_CODE:var p=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24,N=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",o,o+p-1):convertUint8ArrayToUtf8String(e,o,o+p-1);if(r){var C=null;if(i){var k=s?crc32(N):N;a[c]=isolateEvalWithHash(functionCache,k,N,a)}else a[c]=isolateEval(N)}else a[c]=new Code(N,{});o+=p;break;case BSON.BSON_DATA_CODE_W_SCOPE:var L=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24,p=e[o++]|e[o++]<<8|e[o++]<<16|e[o++]<<24,N=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",o,o+p-1):convertUint8ArrayToUtf8String(e,o,o+p-1);o+=p;t.index=o;var w=e[o]|e[o+1]<<8|e[o+2]<<16|e[o+3]<<24,A=BSON.deserialize(e,t,!1);o+=w;if(r){var C=null;if(i){var k=s?crc32(N):N;a[c]=isolateEvalWithHash(functionCache,k,N,a)}else a[c]=isolateEval(N);a[c].scope=A}else a[c]=new Code(N,A)}}a["$id"]!=null&&(a=new DBRef(a.$ref,a.$id,a.$db));return a};BSON.checkKey=function(t){if(!t.length)return;if("$"==t[0])throw Error("key "+t+" must not start with '$'");if(!!~t.indexOf("."))throw Error("key "+t+" must not contain '.'")};BSON.prototype.deserialize=function(e,t){return BSON.deserialize(e,t)};BSON.prototype.deserializeStream=function(e,t,n,r,i,s){return BSON.deserializeStream(e,t,n,r,i,s)};BSON.prototype.serialize=function(e,t,n,r){return BSON.serialize(e,t,n,r)};BSON.prototype.calculateObjectSize=function(e,t){return BSON.calculateObjectSize(e,t)};BSON.prototype.serializeWithBufferAndIndex=function(e,t,n,r,i){return BSON.serializeWithBufferAndIndex(e,t,n,r,i)};if(typeof window=="undefined"){exports.Code=Code;exports.Symbol=Symbol;exports.BSON=BSON;exports.DBRef=DBRef;exports.Binary=Binary;exports.ObjectID=ObjectID;exports.Long=Long;exports.Timestamp=Timestamp;exports.Double=Double;exports.MinKey=MinKey;exports.MaxKey=MaxKey};