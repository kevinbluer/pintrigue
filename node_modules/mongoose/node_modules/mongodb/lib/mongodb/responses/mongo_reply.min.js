var Long=require("bson").Long,MongoReply=exports.MongoReply=function(){this.documents=[];this.index=0};MongoReply.prototype.parseHeader=function(e,t){this.messageLength=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;this.index=this.index+4;this.requestId=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;this.index=this.index+4;this.responseTo=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;this.index=this.index+4+4;this.responseFlag=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;this.index=this.index+4;var n=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;this.index=this.index+4;var r=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;this.index=this.index+4;this.cursorId=new Long(n,r);this.startingFrom=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;this.index=this.index+4;this.numberReturned=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;this.index=this.index+4};MongoReply.prototype.parseBody=function(e,t,n,r){n=n==null?!1:n;var i=20480;if(this.messageLength>i){var s=this.numberReturned;this.documents=new Array(this.numberReturned);for(var o=50;o>0;o--)if(this.numberReturned/o>=1){s=o;break}var u=function(i,s,o,u){var a=0,f=function(){u-a<o&&(o=u-a);if(n){for(var l=0;l<o;l++)if(a<=u){var c=s[i.index]|s[i.index+1]<<8|s[i.index+2]<<16|s[i.index+3]<<24;i.documents[a]=e.slice(i.index,i.index+c);i.index=i.index+c;a+=1}}else try{i.index=t.deserializeStream(e,i.index,o,i.documents,a);a+=o}catch(h){return r(h)}a<u?process.nextTick(f):r(null)};return f}(this,e,s,this.numberReturned)()}else{try{for(var a=0;a<this.numberReturned;a++){var f=e[this.index]|e[this.index+1]<<8|e[this.index+2]<<16|e[this.index+3]<<24;n?this.documents.push(e.slice(this.index,this.index+f)):this.documents.push(t.deserialize(e.slice(this.index,this.index+f)));this.index=this.index+f}}catch(l){return r(l)}r(null)}};MongoReply.prototype.is_error=function(){return this.documents.length==1?this.documents[0].ok==1?!1:!0:!1};MongoReply.prototype.error_message=function(){return this.documents.length==1&&this.documents[0].ok==1?"":this.documents[0].errmsg};